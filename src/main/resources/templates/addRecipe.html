<html lang="ko" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" class=""><!--[endif]-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <title>유스레시피</title>
    <link rel="stylesheet" type="text/css" href="../static/css/templateBody.css"/>
    <link rel="stylesheet" href="../static/css/footer.css"/>
    <link rel="stylesheet" type="text/css" href="../static/css/header.css"/>

    <link href="https://fonts.googleapis.com/css?family=Inter&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Poppins&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="../static/css/bootstrap_20211222.css">
    <link rel="stylesheet" type="text/css" href="../static/css/ez_recipe.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>

    <link rel="stylesheet" type="text/css" href="../static/css/font_20230910.css">
    <link rel="stylesheet" type="text/css" href="../static/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Inter&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Poppins&display=swap" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
        var ingredientIndex = 1

        function addIngredient() {
            var ingredientFrame =
                "<li class='ingredientGroup' id='ingredientGroup_" + ingredientIndex + "'>" +
                "<button type='button' class='btn btn-primary' data-bs-toggle='modal' data-bs-target='#exampleModal' id='ingredientModalBtn'>" +
                "재료 선택" +
                "</button>" +
                "<input name=\"ingredientCategory\" class=\"ingredientCategory\" readonly='' value='-분류-' style='color:#898989'>" +
                "<input name=\"ingredientName\" class=\"ingredientName\" value='-재료명-' readonly='' style='color:#898989'>\n" +
                "<input type=\"text\" class=\"form-control\" style=\"width:100px;\" placeholder=\"10(수량)\"/>\n" +
                "<input type=\"text\" class=\"form-control\" style=\"width:140px;\" placeholder=\"예) g,ml(단위)\"/>\n" +
                "<input type='hidden' name='ingredient_id' class='ingredient_id'>" +
                "<a  href='javascript:delIngredient(" + ingredientIndex + ")' class=\"btn-del\" style=''></a></li>"

            $("#ingredientInfo").append(ingredientFrame)
            ingredientIndex = ingredientIndex + 1
        }

        var stepIndex = 2

        function addStep() {
            var stepFrame =
                '<div id="divStepItem_' + stepIndex + '" class="step">' +
                '    <p class="cont_tit2_1 ui-sortable-handle" style="cursor:pointer"' +
                '        data-original-title="" title="">Step' + stepIndex + '</p>' +
                '    <div style="display:inline-block">' +
                '        <textarea name="step_text" class="step_text form-control step_cont"' +
                '            placeholder="예) 소고기는 기름기를 떼어내고 적당한 크기로 썰어주세요."' +
                '            style="height:160px; width:430px; resize:none;"></textarea>' +
                '    </div>' +
                '    <div id="divStepUpload_' + stepIndex + '" style="display:inline-block">' +
                '        <input type="hidden" name="step_photo" id="step_photo_' + stepIndex + '" value="">' +
                '        <div style="position:absolute;left:-3000px">' +
                '           <input type="file"' +
                '            name="q_step_file_' + stepIndex + '"' +
                '            id="q_step_file_' + stepIndex + '"' +
                '            file_gubun="step"' +
                '            accept="jpeg,png,gif"' +
                '            style="display:;width:0px;height:0px;font-size:0px;"' +
                '           text="">' +
                '       </div>' +
                '        <div is_over="0">' +
                '            <img id="stepPhotoHolder_' + stepIndex + '" onclick="browseStepFile(1)"' +
                '                src="../static/images/pic_none2.gif" width="160"' +
                '                height="160"' +
                '            style="cursor:pointer">' +
                '        </div>' +
                '        </div>' +
                '              <div id="divStepBtn_' + stepIndex + '" class="step_btn" style="display:">' +
                '                  <a href="javascript:delStep(' + stepIndex + ')"><span class="glyphicon glyphicon-remove"></span></a>' +
                '        </div>' +
                '</div>'

            $("#divStepArea").append(stepFrame)
            stepIndex = stepIndex + 1
        }

        function delStep(idx) {
            var re = confirm("정말 해당 요리 순서를 삭제하시겠습니까?")
            if(re==1) {
                var divStep = $("#divStepItem_" + idx);
                var nextDivs = []
                nextDivs = divStep.nextAll()
                if (nextDivs.length === 0) {
                    stepIndex = 2;
                }
                $.each(nextDivs, function (num) {
                    var index = idx + num
                    console.log(index)
                    $(this).attr("id", "divStepItem_" + index)
                    $(this).children("p").text("Step" + index)
                    $(this).children("#stepPhotoHolder_" + (index + 1)).attr("id", "stepPhotoHolder_" + index)
                    $(this).children(".step_btn").children("a").attr('href', "javascript:delStep(" + index + ")")
                    stepIndex = index + 1;
                })
                divStep.remove()
            }
        }

        var ingredientGroup_id
        $(document).on('click', "#ingredientModalBtn", function () {
            ingredientGroup_id = "#" + $(this).parent().attr('id')
        })

        $(document).on('click', "#ingredient_modal_save", function () {
            var ingredientName = $("input[name=ingredient_radio]:checked").prev().text()
            var ingredientCategory = $("input[name=ingredient_radio]:checked").prev().prev().text()
            var ingredient_id = $("input[name=ingredient_radio]:checked").next().val()
            $(ingredientGroup_id).children(".ingredientCategory").val(ingredientCategory).css('color', '').css('font-weight', 'bold')
            $(ingredientGroup_id).children(".ingredientName").val(ingredientName).css('color', '').css('font-weight', 'bold')
            $(ingredientGroup_id).children(".ingredient_id").val(ingredient_id)
        })

        function delIngredient(index) {
            var ingredientGroup = "#ingredientGroup_" + index;
            $("li").remove(ingredientGroup);
        }

        $(document).on('click', '.modal_IngredientSelect', function () {
            var checkbox = $(this).find('input');
            $(this).find('input').prop('checked', true)
        })

        function browseMainFile() {
            $("#q_main_file").click();
        }

        $(document).on('change', "#q_main_file", handlePhotoFiles)


        function handlePhotoFiles() {
            var image = $("#q_main_file")[0].files
            data = new FormData();
            data.append("file", image[0]);
            $.ajax({
                data: data,
                type: "POST",
                url: "/uploadRecipeMainPhoto",
                contentType: false,
                processData: false,
                success: function (data) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        $('#mainPhotoHolder').attr('src', e.target.result); // 이미지 미리보기 설정
                    };
                    reader.readAsDataURL(image[0]); // 파일을 읽어서 Data URL로 변환하여 이미지에 적용
                    $("#recipe_thumbnail").val(data.url)
                }
            });
        }

        // 모달창에서 엔터 누르면 검색 되는 함수
        $(document).on('keyup', '#keyword', function enter_search(e) {
            console.log(e.code)
            const code = e.code;

            if (code == 'Enter') {
                searchIngredient();
            }
        })

        $(document).on('click', '#ingredientSearchBtn', searchIngredient)

        //재료 검색 ajax 통신 함수
        function searchIngredient() {
            $("#ingredientList").empty()
            var keyword = $("#keyword").val()
            data = {keyword: keyword};
            $.ajax({
                data: data,
                type: 'POST',
                url: '/searchIngredient',
                success: function (list) {
                    console.log(list)
                    $.each(list, function () {
                        var ingredientCategoryName = this.ingredientIngredientCategory.ingredientCategoryName
                        var ingredientName = this.ingredientName
                        var ingredient_id = this.id
                        var li = '<li class="modal_IngredientSelect">' +
                            '<div class="cell">' + ingredientCategoryName + '</div>' +
                            '<div class="cell">' + ingredientName + '</div>' +
                            '<input type="radio" name="ingredient_radio" class="cell"/>' +
                            '<input type="hidden" name="ingredient_id" value="' + ingredient_id + '"/>' +
                            '</li>'
                        $("#ingredientList").append($(li));
                    });
                }
            })
        }
    </script>

</head>
<body>
<div class="templateBody">
    <header>
        <div class="header" th:replace="header :: header"></div>
    </header>
    <div class="mainBody">
        <form name="insFrm" id="insFrm" method="post">

            <div class="container recipe_regi">
                <div class="regi_center">
                    <div class="regi_title">레시피 등록
                    </div>
                    <div class="cont_box pad_l_60">
                        <div id="divMainPhotoUpload" class="cont_pic2">
                            <input type="hidden" name="main_photo" id="main_photo" value="">
                            <input type="hidden" name="new_main_photo" id="new_main_photo" value="">
                            <input type="hidden" name="del_main_photo" id="del_main_photo" value="">
                            <div style="position:absolute;left:-3000px">
                                <input type="file" name="q_main_file"
                                       id="q_main_file" accept="jpeg,png,gif"
                                       style="width:0px;height:0px;font-size:0px;"
                                       text="">
                            </div>
                            <div id="divMainPhotoBox" is_over="0">
                                <img id="mainPhotoHolder" onclick="browseMainFile()"
                                     src="../static/images/pic_none4.gif"
                                     style="width: 250px; height: 250px; cursor:pointer">
                                <input type="hidden" id="recipe_thumbnail" name="recipe_thumbnail">
                            </div>
                        </div>
                        <div class="cont_line">
                            <p class="cont_tit4">레시피 제목</p>
                            <input type="text" name="cok_title"
                                   id="cok_title"
                                   value="" class="form-control"
                                   placeholder="예) 소고기 미역국 끓이기"
                                   style="width:610px; ">
                        </div>
                        <div class="cont_line pad_b_25">
                            <p class="cont_tit4">요리소개</p>
                            <textarea name="cok_intro"
                                      id="cok_intro"
                                      class="form-control step_cont"
                                      placeholder="이 레시피의 탄생배경을 적어주세요. 예) 남편의 생일을 맞아 소고기 미역국을 끓여봤어요. 어머니로부터 배운 미역국 레시피를 남편의 입맛에 맞게 고안했습니다."
                                      style="height:100px; width:610px; resize:none;"></textarea>
                        </div>

                        <div class="cont_line pad_b_25">
                            <p class="cont_tit4">동영상</p>
                            <input type="hidden" name="video_photo" id="video_photo" value="">
                            <input type="hidden" name="new_video_photo" id="new_video_photo" value="">
                            <input type="hidden" name="del_video_photo" id="del_video_photo" value="">
                            <input type="hidden" name="cok_video_src" id="cok_video_src" value="">
                            <textarea name="cok_video_url" id="cok_video_url" class="form-control step_cont" prev_url=""
                                      placeholder="동영상이 있으면 주소를 입력하세요.(Youtube,네이버tvcast,다음tvpot 만 가능) 예)http://youtu.be/lA0Bxo3IZmM"
                                      style="height:100px; width:380px; resize:none;"></textarea>
                            <div style="position:absolute;left:-3000px">
                                <input type="file" name="q_video_file"
                                       id="q_video_file"
                                       file_gubun="video" accept="jpeg,png,gif"
                                       style="width:0px;height:0px;font-size:0px;"
                                       text="">
                            </div>
                        </div>

                        <div class="cont_line"><p class="cont_tit4">카테고리</p>
                            <select name="cok_sq_category_4" id="cok_sq_category_4" text="종류별">
                                <option value="">종류별</option>
                                <option value="63">밑반찬</option>
                                <option value="56">메인반찬</option>
                                <option value="54">국/탕</option>
                                <option value="55">찌개</option>
                                <option value="60">디저트</option>
                                <option value="53">면/만두</option>
                                <option value="52">밥/죽/떡</option>
                                <option value="61">퓨전</option>
                                <option value="57">김치/젓갈/장류</option>
                                <option value="58">양념/소스/잼</option>
                                <option value="65">양식</option>
                                <option value="64">샐러드</option>
                                <option value="68">스프</option>
                                <option value="66">빵</option>
                                <option value="69">과자</option>
                                <option value="59">차/음료/술</option>
                                <option value="62">기타</option>
                            </select>


                            <span class="guide"
                                  style="margin:-22px 0 0 146px;">분류를 바르게 설정해주시면, 이용자들이 쉽게 레시피를 검색할 수 있어요.</span>
                        </div>
                    </div><!--/cont_box-->
                    <div class="cont_box pad_l_60">
                        <p class="cont_tit3">재료 정보
                        </p>
                        <span class="guide mag_b_15" style="width:100%;">재료가 남거나 부족하지 않도록 정확한 계량정보를 적어주세요.</span>
                        <div class="mag_b_25 ui-sortable" id="divMaterialGroupArea"
                             style="border-bottom: 4px solid #f1f1f2;">
                            <li>
                                <p class="cont_tit6 st2 mag_r_15">
                                    <input
                                            type="text" name="material_group_title_1" id="material_group_title_1"
                                            value="재료를 선택해주세요"
                                            class="form-control" style="font-weight:bold;font-size:18px;width:210px;"
                                            disabled="">
                                </p>
                                <ul class="ui-sortable" id="ingredientInfo">
                                    <li class='ingredientGroup' id='ingredientGroup_0'>
                                        <button type='button' class='btn btn-primary' data-bs-toggle='modal'
                                                data-bs-target='#exampleModal' id='ingredientModalBtn'>
                                            재료 선택
                                        </button>
                                        <input name="ingredientCategory" class="ingredientCategory" readonly=''
                                               value='-분류-' style='color:#898989'>
                                        <input name="ingredientName" class="ingredientName" value='-재료명-' readonly=''
                                               style='color:#898989'>
                                        <input type="text" class="form-control" style="width:100px;"
                                               placeholder="10(수량)"/>
                                        <input type="text" class="form-control" style="width:140px;"
                                               placeholder="예) g,ml(단위)"/>
                                        <input type='hidden' name='ingredient_id' class='ingredient_id'>
                                </ul>
                                <div class="btn_add" style="padding:0 0 20px 350px; width:800px;">
                                    <button type="button" onclick="addIngredient()" class="btn btn-default"><span
                                            class="glyphicon glyphicon-plus-sign"></span>추가
                                    </button>
                                </div>
                            </li>

                        </div>
                        <div class="cont_box pad_l_60">
                            <input type="file" name="file" id="multifile_1" file_gubun="step" style="display:none;"
                                   multiple="">
                            <p class="cont_tit3">요리순서
                            </p>
                            <span class="guide mag_b_15"><b>요리의 맛이 좌우될 수 있는 중요한 부분은 빠짐없이 적어주세요.</b><br>
		예) 10분간 익혀주세요 ▷ 10분간 약한불로 익혀주세요.<br>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;마늘편은 익혀주세요 ▷ 마늘편을 충분히 익혀주셔야 매운 맛이 사라집니다.<br>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;꿀을 조금 넣어주세요 ▷ 꿀이 없는 경우, 설탕 1스푼으로 대체 가능합니다.
	  </span>
                            <div id="divStepArea" class="ui-sortable">
                                <div id="divStepItem_1" class="step">
                                    <p class="cont_tit2_1 ui-sortable-handle" style="cursor:pointer"
                                       data-original-title="" title="">Step1</p>
                                    <div style="display:inline-block">
                                    <textarea class="step_text form-control step_cont"
                                              placeholder="예) 소고기는 기름기를 떼어내고 적당한 크기로 썰어주세요."
                                              style="height:160px; width:430px; resize:none;"></textarea>
                                    </div>
                                    <div id="divStepUpload_1" style="display:inline-block">
                                        <input type="hidden" name="step_photo" id="step_photo_1" value="">
                                        <div style="position:absolute;left:-3000px">
                                            <input type="file"
                                                   name="q_step_file_1"
                                                   id="q_step_file_1"
                                                   file_gubun="step"
                                                   accept="jpeg,png,gif"
                                                   style="display:;width:0px;height:0px;font-size:0px;"
                                                   text="">
                                        </div>
                                        <div is_over="0">
                                            <img id="stepPhotoHolder_1" onclick="browseStepFile(1)"
                                                 src="../static/images/pic_none2.gif" width="160"
                                                 height="160"
                                                 style="cursor:pointer">
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <!-- step template -->

                            <div class="btn_add mag_b_25" style="padding:0 0 20px 180px; width:820px;">
                                <button type="button" onclick="addStep()" class="btn btn-default"><span
                                        class="glyphicon glyphicon-plus-sign"></span>순서추가
                                </button>
                            </div>


                            <p class="cont_tit4">요리완성사진
                                <input type="file" name="file" id="multifile_2" file_gubun="work" style="display:none;"
                                       multiple="">
                                <br>
                            </p>
                            <div id="divWorkArea" style="display:inline-block" class="ui-sortable">
                                <div id="divWorkUpload_0" class="complete_pic">
                                    <input type="hidden" name="work_photo[]" id="work_photo_1" value="">
                                    <input type="hidden" name="new_work_photo[]" id="new_work_photo_1" value="">
                                    <input type="hidden" name="del_work_photo[]" id="del_work_photo_1" value="">
                                    <div style="position:absolute;left:-3000px"><input type="file" name="q_work_file_1"
                                                                                       id="q_work_file_1"
                                                                                       file_gubun="work"
                                                                                       accept="jpeg,png,gif"
                                                                                       style="display:;width:0px;height:0px;font-size:0px;"
                                                                                       text=""></div>
                                    <div id="divWorkPhotoBox_1" is_over="0">
                                        <a href="#" class="pic_del" style="display:none"></a>
                                        <img id="workPhotoHolder_1" onclick="browseWorkFile(1)"
                                             src="../static/images/pic_none3.gif" alt="No Image"
                                             style="width: 140px; height: 140px; cursor:pointer">
                                    </div>
                                </div>

                            </div>
                        </div><!--/cont_box-->

                    </div><!--/regi_center-->
                    <div class="regi_btm">
                        <button type="button" onclick="doSubmit('save')" class="btn-lg btn-primary">저장</button>
                        <button type="button" onclick="history.back();" class="btn-lg btn-default">취소</button>
                    </div>
                </div><!-- /container -->
            </div>
        </form>

        <!-- 최근 본 상품 js -->
        <script>
            var curVRPage = 1;
            var totalVRcnt = 0;

            function getViewRecipeList(page) {
                if ($("#rRecipContDivPage_" + page).length > 0) {
                    $("[id^='rRecipContDivPage_']").hide();
                    $("#rRecipContDivPage_" + page).show();
                    curVRPage = page;
                    return;
                }
                var rvArr = storageUtil.get('stRecentViewRecipe');
                if (!rvArr || rvArr == 'FAIL') {
                    $("#recentRecipeDiv").hide();
                    return;
                }
                totalVRcnt = rvArr.length;
                var scale = 6;
                var skip = (page - 1) * scale;
                var lastpage = Math.ceil(totalVRcnt / scale);
                var hstr = '';
                hstr += '<div id="rRecipContDivPage_' + page + '" class="row">';
                if (page > 1) hstr += '<a href="javascript:void(0);" class="list_btn_pre" onClick="getViewRecipeList(' + (page - 1) + ')"><img src="https://recipe1.ezmember.co.kr/img/btn_arrow1_l.png" alt="이전"></a>';
                if (page < lastpage) hstr += '<a href="javascript:void(0);" class="list_btn_next" onClick="getViewRecipeList(' + (page + 1) + ')"><img src="https://recipe1.ezmember.co.kr/img/btn_arrow1_r.png" alt="다음"></a>';
                for (var i = skip; i < skip + scale; i++) {
                    var rvs = rvArr[i];
                    if (!rvs) continue;
                    hstr += '<div class="col-xs-2">';
                    hstr += '<a class="thumbnail" href="https://www.10000recipe.com/recipe/' + rvs.seq + '"><img src="' + rvs.thumb + '" style="width:180px; height:180px;">';
                    hstr += '<div class="caption elipsis_rrtitle"><b>' + rvs.title + '</b></div></a>';
                    hstr += '</div>';
                }
                hstr += '</div>';
                if (page != 1 && curVRPage > page) $("#recentRecipeContDiv").prepend(hstr);
                else $("#recentRecipeContDiv").append(hstr);
                getViewRecipeList(page);
                $(".elipsis_rrtitle").ellipsis({row: 2});
            }

            $(document).ready(function () {
                getViewRecipeList(1);
            })
        </script>
        <!-- 최근 본 상품 js -->

        <div id="recentRecipeDiv" class="container">
            <div class="rcp_lately_list">
                <h3>최근 본 레시피</h3>
                <div id="recentRecipeContDiv">
                    <div id="rRecipContDivPage_1" class="row" style="display: block;">
                        <div class="col-xs-2"><a class="thumbnail"
                                                 href="https://www.10000recipe.com/recipe/6971271"><img
                                src="https://recipe1.ezmember.co.kr/cache/recipe/2021/12/20/3a285793c9ebffbb37d27596aef660f51_m.jpg"
                                style="width:180px; height:180px;">
                            <div class="caption elipsis_rrtitle">전참시 유병재가 만든 찜닭! 꽈리고추닭볶음 ...</div>
                        </a></div>
                        <div class="col-xs-2"><a class="thumbnail"
                                                 href="https://www.10000recipe.com/recipe/6850116"><img
                                src="https://recipe1.ezmember.co.kr/cache/recipe/2016/05/29/2a170363760225a934d26ff7e94cede31_m.jpg"
                                style="width:180px; height:180px;">
                            <div class="caption elipsis_rrtitle">백종원 돼지고기 김치찌개 만들기 ...</div>
                        </a></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 최근 본 상품 div -->

        <!-- Modal -->
        <div class="modal fade in" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
             aria-hidden="true">
            <div class="modal-dialog" style="width:520px">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">재료 검색 하기</h5>
                    </div>
                    <div class="modal-body">
                        <input type="text" placeholder="원하는 재료를 입력해주세요." name="keyword" id="keyword"
                               style="width: 80%;height:34px">
                        <button class="btn btn-primary" id="ingredientSearchBtn">검색</button>
                        <div style="width: auto; height:500px; border: 1px solid; overflow: auto">
                            <div class="modal_IngredientSelect_column">
                                <div class="cell">카테고리</div>
                                <div class="cell">재료명</div>
                                <div class="cell">선택</div>
                            </div>
                            <ul style="margin-right: 10px; padding:0 0 0 0" id="ingredientList">

                            </ul>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                        <button type="button" class="btn btn-primary" id="ingredient_modal_save"
                                data-bs-dismiss="modal">저장
                        </button>
                    </div>
                </div>
            </div>
        </div>


    </div>
    <div class="footer" th:replace="footer :: footer"></div>
</div>
</body>

</html>